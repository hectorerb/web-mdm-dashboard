---
layout: container
---

<div class="row">
  <div class="col-md-6">
        <a class="btn btn-lightweight no-outline navigation-btn">Index</a><ul role="navigation" id="sidenav-small" class="nav side-navigation side-navigation-small theme-default"><button type="button" class="close" data-dismiss="side-navigation" aria-label="close"><i class="glyph glyph-cancel"></i></button><li class="active side-nav-c2">Modules</li><ul class="nav collapse in" id="father-john-misty"><li><a href="module-animations.html">animations</a></li><li><a href="module-animations%2525252520WinJS.html">animations WinJS</a></li><li><a href="module-BuildItemList.html">BuildItemList</a></li><li><a href="module-bytesToSize.html">bytesToSize</a></li><li><a href="module-calc100PercentMinus.html">calc100PercentMinus</a></li><li><a href="module-configureDisplay.html">configureDisplay</a></li><li><a href="module-cookie.html">cookie</a></li><li><a href="module-getMode.html">getMode</a></li><li><a href="module-glpiApi.html">glpiApi</a></li><li><a href="module-handleMessage.html">handleMessage</a></li><li><a href="module-history.html">history</a></li><li><a href="module-itemtype.html">itemtype</a></li><li><a href="module-logout.html">logout</a></li><li><a href="module-nativeNotification.html">nativeNotification</a></li><li><a href="module-publicURL.html">publicURL</a></li><li><a href="module-setGlpiCookie.html">setGlpiCookie</a></li><li><a href="module-toDateInputValue.html">toDateInputValue</a></li><li><a href="module-updateObject.html">updateObject</a></li><li><a href="module-validateData.html">validateData</a></li><li><a href="module-validateDate.html">validateDate</a></li><li><a href="module-validateNotification.html">validateNotification</a></li></ul><li class="active side-nav-c2">Classes</li><ul class="nav collapse in" id="father-john-misty"><li><a href="About.html">About</a></li><li><a href="AdminDashboard.html">AdminDashboard</a></li><li><a href="AdminDashboardLayout.html">AdminDashboardLayout</a></li><li><a href="Applications.html">Applications</a></li><li><a href="ApplicationsAdd.html">ApplicationsAdd</a></li><li><a href="ApplicationsContent.html">ApplicationsContent</a></li><li><a href="ApplicationsEdit.html">ApplicationsEdit</a></li><li><a href="ApplicationsEditItemList.html">ApplicationsEditItemList</a></li><li><a href="ApplicationsItemList.html">ApplicationsItemList</a></li><li><a href="ApplicationsList.html">ApplicationsList</a></li><li><a href="ChangeDownloadURL.html">ChangeDownloadURL</a></li><li><a href="ChangeTokenLife.html">ChangeTokenLife</a></li><li><a href="Confirmation.html">Confirmation</a></li><li><a href="ContentPane.html">ContentPane</a></li><li><a href="DangerZone.html">DangerZone</a></li><li><a href="Dashboard.html">Dashboard</a></li><li><a href="DatePicker.html">DatePicker</a></li><li><a href="Devices.html">Devices</a></li><li><a href="DevicesAssociated.html">DevicesAssociated</a></li><li><a href="DevicesContent.html">DevicesContent</a></li><li><a href="DevicesEdit.html">DevicesEdit</a></li><li><a href="DevicesEditOne.html">DevicesEditOne</a></li><li><a href="DevicesItemList.html">DevicesItemList</a></li><li><a href="DevicesList.html">DevicesList</a></li><li><a href="Display.html">Display</a></li><li><a href="EditMultiple.html">EditMultiple</a></li><li><a href="Enroll.html">Enroll</a></li><li><a href="Entity.html">Entity</a></li><li><a href="ErrorValidation.html">ErrorValidation</a></li><li><a href="Feedback.html">Feedback</a></li><li><a href="Files.html">Files</a></li><li><a href="FilesAdd.html">FilesAdd</a></li><li><a href="FilesContent.html">FilesContent</a></li><li><a href="FilesEdit.html">FilesEdit</a></li><li><a href="FilesEditItemList.html">FilesEditItemList</a></li><li><a href="FilesItemList.html">FilesItemList</a></li><li><a href="FilesList.html">FilesList</a></li><li><a href="FilesUpload.html">FilesUpload</a></li><li><a href="FilesUploadItemList.html">FilesUploadItemList</a></li><li><a href="FileswithHandleMessages.html">FileswithHandleMessages</a></li><li><a href="Fleets.html">Fleets</a></li><li><a href="FleetsContent.html">FleetsContent</a></li><li><a href="FleetsEdit.html">FleetsEdit</a></li><li><a href="FleetsList.html">FleetsList</a></li><li><a href="FleetsTaskItemList.html">FleetsTaskItemList</a></li><li><a href="ForgotPassword.html">ForgotPassword</a></li><li><a href="Geolocation.html">Geolocation</a></li><li><a href="GeolocationList.html">GeolocationList</a></li><li><a href="GeolocationRange.html">GeolocationRange</a></li><li><a href="HeaderBreadcrumb.html">HeaderBreadcrumb</a></li><li><a href="HelpCenter.html">HelpCenter</a></li><li><a href="HelpCenterArticle.html">HelpCenterArticle</a></li><li><a href="HelpCenterList.html">HelpCenterList</a></li><li><a href="IconItemList.html">IconItemList</a></li><li><a href="IconWithPopper.html">IconWithPopper</a></li><li><a href="ImgWithPopper.html">ImgWithPopper</a></li><li><a href="Input.html">Input</a></li><li><a href="Inventory.html">Inventory</a></li><li><a href="Invitations.html">Invitations</a></li><li><a href="InvitationsItemList.html">InvitationsItemList</a></li><li><a href="InvitationsList.html">InvitationsList</a></li><li><a href="InvitationsPendingPage.html">InvitationsPendingPage</a></li><li><a href="License.html">License</a></li><li><a href="ListWithNavLinks.html">ListWithNavLinks</a></li><li><a href="Main.html">Main</a></li><li><a href="Map.html">Map</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="Notifications.html">Notifications</a></li><li><a href="Panel.html">Panel</a></li><li><a href="PanelFields.html">PanelFields</a></li><li><a href="PanelResults.html">PanelResults</a></li><li><a href="PasswordFieldset.html">PasswordFieldset</a></li><li><a href="Profiles.html">Profiles</a></li><li><a href="ReleaseNotes.html">ReleaseNotes</a></li><li><a href="ResetPassword.html">ResetPassword</a></li><li><a href="RootApp.html">RootApp</a></li><li><a href="ScrollSync.html">ScrollSync</a></li><li><a href="ScrollSyncPanel.html">ScrollSyncPanel</a></li><li><a href="SearchEngine.html">SearchEngine</a></li><li><a href="SearchQueryBuilder.html">SearchQueryBuilder</a></li><li><a href="Security.html">Security</a></li><li><a href="Select.html">Select</a></li><li><a href="Settings.html">Settings</a></li><li><a href="SignIn.html">SignIn</a></li><li><a href="SignUp.html">SignUp</a></li><li><a href="SpanWithPopper.html">SpanWithPopper</a></li><li><a href="SplitView.html">SplitView</a></li><li><a href="Supervision.html">Supervision</a></li><li><a href="SystemInformation.html">SystemInformation</a></li><li><a href="SystemReport.html">SystemReport</a></li><li><a href="TasksDeployAppList.html">TasksDeployAppList</a></li><li><a href="TasksDeployFileList.html">TasksDeployFileList</a></li><li><a href="TasksRemoveAppList.html">TasksRemoveAppList</a></li><li><a href="TasksRemoveFileList.html">TasksRemoveFileList</a></li><li><a href="global.html#UsernameFieldset">UsernameFieldset</a></li><li><a href="Users.html">Users</a></li><li><a href="UsersContent.html">UsersContent</a></li><li><a href="UsersEditOne.html">UsersEditOne</a></li><li><a href="UsersItemList.html">UsersItemList</a></li><li><a href="UsersList.html">UsersList</a></li><li><a href="ValidateAccount.html">ValidateAccount</a></li></ul><li class="active side-nav-c2"><a href="global.html">Global</a><ul class="nav collapse in" id="father-john-misty"><li><a href="global.html#addEmail">addEmail</a></li><li><a href="global.html#addEvents">addEvents</a></li><li><a href="global.html#addMarkers">addMarkers</a></li><li><a href="global.html#agent">agent</a></li><li><a href="global.html#applyRange">applyRange</a></li><li><a href="global.html#arrayResultsWithFields">arrayResultsWithFields</a></li><li><a href="global.html#asyncAdminDashboard">asyncAdminDashboard</a></li><li><a href="global.html#asyncForgotPassword">asyncForgotPassword</a></li><li><a href="global.html#asyncLogout">asyncLogout</a></li><li><a href="global.html#asyncPasswordFieldset">asyncPasswordFieldset</a></li><li><a href="global.html#asyncResetPassword">asyncResetPassword</a></li><li><a href="global.html#asyncSignUp">asyncSignUp</a></li><li><a href="global.html#asyncValidateAccount">asyncValidateAccount</a></li><li><a href="global.html#blurInput">blurInput</a></li><li><a href="global.html#breadcrumbs">breadcrumbs</a></li><li><a href="global.html#bugsnagClient">bugsnagClient</a></li><li><a href="global.html#buildDataArray">buildDataArray</a></li><li><a href="global.html#buildList">buildList</a></li><li><a href="global.html#cancel">cancel</a></li><li><a href="global.html#change">change</a></li><li><a href="global.html#changeAction">changeAction</a></li><li><a href="global.html#changeEmail">changeEmail</a></li><li><a href="global.html#changeInput">changeInput</a></li><li><a href="global.html#changeLocalStorage">changeLocalStorage</a></li><li><a href="global.html#changeMode">changeMode</a></li><li><a href="global.html#changeNotificationType">changeNotificationType</a></li><li><a href="global.html#changePhase">changePhase</a></li><li><a href="global.html#changeRange">changeRange</a></li><li><a href="global.html#changeSelect">changeSelect</a></li><li><a href="global.html#changeselectedItem">changeselectedItem</a></li><li><a href="global.html#changeSelectedItems">changeSelectedItems</a></li><li><a href="global.html#changeSelectionMode">changeSelectionMode</a></li><li><a href="global.html#changeShowNotifications">changeShowNotifications</a></li><li><a href="global.html#changeState">changeState</a></li><li><a href="global.html#checkValidServiceWorker">checkValidServiceWorker</a></li><li><a href="global.html">childContextTypes</a></li><li><a href="global.html#cleanWebStorage">cleanWebStorage</a></li><li><a href="global.html#closeSession">closeSession</a></li><li><a href="global.html#componentDidMount">componentDidMount</a></li><li><a href="global.html#componentDidUpdate">componentDidUpdate</a></li><li><a href="global.html#componentWillUnmount">componentWillUnmount</a></li><li><a href="global.html#ConstructInputs">ConstructInputs</a></li><li><a href="global.html#Contant">Contant</a></li><li><a href="global.html">contextTypes</a></li><li><a href="global.html#createFields">createFields</a></li><li><a href="global.html#createListElement">createListElement</a></li><li><a href="global.html#createRenderElament">createRenderElament</a></li><li><a href="global.html#days">days</a></li><li><a href="global.html">defaultProps</a></li><li><a href="global.html#delete">delete</a></li><li><a href="global.html#deleteEmail">deleteEmail</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#EmptyMessage">EmptyMessage</a></li><li><a href="global.html#ErrorBoundary">ErrorBoundary</a></li><li><a href="global.html#ErrorPage">ErrorPage</a></li><li><a href="global.html#fileExtension">fileExtension</a></li><li><a href="global.html#fileSizeAcceptable">fileSizeAcceptable</a></li><li><a href="global.html#filesRemoveAll">filesRemoveAll</a></li><li><a href="global.html#filesRemoveOne">filesRemoveOne</a></li><li><a href="global.html#filesUpload">filesUpload</a></li><li><a href="global.html#fileTypeAcceptable">fileTypeAcceptable</a></li><li><a href="global.html#filterPoliciesPerCategory">filterPoliciesPerCategory</a></li><li><a href="global.html#findPanel">findPanel</a></li><li><a href="global.html#FleetsItemList">FleetsItemList</a></li><li><a href="global.html#forceAnimation">forceAnimation</a></li><li><a href="global.html#GenerateRoutes">GenerateRoutes</a></li><li><a href="global.html#getApplications">getApplications</a></li><li><a href="global.html#getChildContext">getChildContext</a></li><li><a href="global.html">getDerivedStateFromProps</a></li><li><a href="global.html#getDevices">getDevices</a></li><li><a href="global.html#getDevicesByOperatingSystemVersion">getDevicesByOperatingSystemVersion</a></li><li><a href="global.html#getDevicesByUsers">getDevicesByUsers</a></li><li><a href="global.html#getFiles">getFiles</a></li><li><a href="global.html#getFleets">getFleets</a></li><li><a href="global.html#getImage">getImage</a></li><li><a href="global.html#getInvitations">getInvitations</a></li><li><a href="global.html#getPendingInvitations">getPendingInvitations</a></li><li><a href="global.html#getQueryString">getQueryString</a></li><li><a href="global.html#getTranslation">getTranslation</a></li><li><a href="global.html#getTypeData">getTypeData</a></li><li><a href="global.html#getUsers">getUsers</a></li><li><a href="global.html#getValueOfTask">getValueOfTask</a></li><li><a href="global.html#goToList">goToList</a></li><li><a href="global.html#goToLocation">goToLocation</a></li><li><a href="global.html#groupHeaderRenderer">groupHeaderRenderer</a></li><li><a href="global.html#handleActivePolicyToggle">handleActivePolicyToggle</a></li><li><a href="global.html#handleAdd">handleAdd</a></li><li><a href="global.html#handleAddedToggle">handleAddedToggle</a></li><li><a href="global.html#handleAddTask">handleAddTask</a></li><li><a href="global.html#handleBlurInput">handleBlurInput</a></li><li><a href="global.html#handleChangeInput">handleChangeInput</a></li><li><a href="global.html#handleChangeItemType">handleChangeItemType</a></li><li><a href="global.html#handleChangeQuery">handleChangeQuery</a></li><li><a href="global.html#handleCreateFleet">handleCreateFleet</a></li><li><a href="global.html#handleDelete">handleDelete</a></li><li><a href="global.html#handleDeleteFleet">handleDeleteFleet</a></li><li><a href="global.html#handleDuplicateFleet">handleDuplicateFleet</a></li><li><a href="global.html#handleEdit">handleEdit</a></li><li><a href="global.html#handleFleetHaveTask">handleFleetHaveTask</a></li><li><a href="global.html#handleFormSubmit">handleFormSubmit</a></li><li><a href="global.html#handleOnSearch">handleOnSearch</a></li><li><a href="global.html#handlePanelScroll">handlePanelScroll</a></li><li><a href="global.html#handleRecover">handleRecover</a></li><li><a href="global.html#handleRefresh">handleRefresh</a></li><li><a href="global.html#handleRemove">handleRemove</a></li><li><a href="global.html#handleRemoveTask">handleRemoveTask</a></li><li><a href="global.html#handleRemoveValueTask">handleRemoveValueTask</a></li><li><a href="global.html#handleRequestItemType">handleRequestItemType</a></li><li><a href="global.html#handleResendEmail">handleResendEmail</a></li><li><a href="global.html#handleResetPassword">handleResetPassword</a></li><li><a href="global.html#handleResize">handleResize</a></li><li><a href="global.html#handleSave">handleSave</a></li><li><a href="global.html#handleSaveFiles">handleSaveFiles</a></li><li><a href="global.html#handleSaveFleet">handleSaveFleet</a></li><li><a href="global.html#handleSaveOneDevices">handleSaveOneDevices</a></li><li><a href="global.html#handleSelectionChanged">handleSelectionChanged</a></li><li><a href="global.html#handleSort">handleSort</a></li><li><a href="global.html#handleSubmitForm">handleSubmitForm</a></li><li><a href="global.html#handleToggleSelectionMode">handleToggleSelectionMode</a></li><li><a href="global.html#handleUpdateFleet">handleUpdateFleet</a></li><li><a href="global.html#handleUpdateFleetName">handleUpdateFleetName</a></li><li><a href="global.html#handleUpdateValueTask">handleUpdateValueTask</a></li><li><a href="global.html#headerComponent">headerComponent</a></li><li><a href="global.html#InfoBox">InfoBox</a></li><li><a href="global.html#inviteDevice">inviteDevice</a></li><li><a href="global.html#isAuthenticated">isAuthenticated</a></li><li><a href="global.html#isLocalhost">isLocalhost</a></li><li><a href="global.html">isOK</a></li><li><a href="global.html#ItemListRenderer">ItemListRenderer</a></li><li><a href="global.html#languages">languages</a></li><li><a href="global.html#listRender">listRender</a></li><li><a href="global.html#listRequest">listRequest</a></li><li><a href="global.html#loadComponent">loadComponent</a></li><li><a href="global.html#loader">loader</a></li><li><a href="global.html#Loader">Loader</a></li><li><a href="global.html#Loading">Loading</a></li><li><a href="global.html#loadMoreData">loadMoreData</a></li><li><a href="global.html#LogInServer">LogInServer</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#mimeTypeLeft">mimeTypeLeft</a></li><li><a href="global.html#mimeTypeRight">mimeTypeRight</a></li><li><a href="global.html#months">months</a></li><li><a href="global.html#normalizeQuery">normalizeQuery</a></li><li><a href="global.html#normalizeRule">normalizeRule</a></li><li><a href="global.html#onDragEnter">onDragEnter</a></li><li><a href="global.html#onDragLeave">onDragLeave</a></li><li><a href="global.html#onDragOver">onDragOver</a></li><li><a href="global.html#onDrop">onDrop</a></li><li><a href="global.html#onError">onError</a></li><li><a href="global.html#onFilesChange">onFilesChange</a></li><li><a href="global.html#onFilesError">onFilesError</a></li><li><a href="global.html#openFileChooser">openFileChooser</a></li><li><a href="global.html#Overview">Overview</a></li><li><a href="global.html#panels">panels</a></li><li><a href="global.html#ping">ping</a></li><li><a href="global.html#previewFile">previewFile</a></li><li><a href="global.html#PrivateRoute">PrivateRoute</a></li><li><a href="global.html#propsData">propsData</a></li><li><a href="global.html#PropsRoute">PropsRoute</a></li><li><a href="global.html">propTypes</a></li><li><a href="global.html#recursiveExtractQueryRules">recursiveExtractQueryRules</a></li><li><a href="global.html#refreshRender">refreshRender</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerPanel">registerPanel</a></li><li><a href="global.html#registerValidSW">registerValidSW</a></li><li><a href="global.html#removeEvents">removeEvents</a></li><li><a href="global.html#removeFile">removeFile</a></li><li><a href="global.html#removeFiles">removeFiles</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderElement">renderElement</a></li><li><a href="global.html#renderGraphics">renderGraphics</a></li><li><a href="global.html#renderInfoBox">renderInfoBox</a></li><li><a href="global.html#RenderMergedProps">RenderMergedProps</a></li><li><a href="global.html#renderMinMaxVersion">renderMinMaxVersion</a></li><li><a href="global.html#requestAllData">requestAllData</a></li><li><a href="global.html#requestInventory">requestInventory</a></li><li><a href="global.html#requestLocation">requestLocation</a></li><li><a href="global.html#requestValidation">requestValidation</a></li><li><a href="global.html#resetData">resetData</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#saveChanges">saveChanges</a></li><li><a href="global.html#savePassword">savePassword</a></li><li><a href="global.html#saveTokenLife">saveTokenLife</a></li><li><a href="global.html#saveURL">saveURL</a></li><li><a href="global.html#saveValues">saveValues</a></li><li><a href="global.html#setFields">setFields</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showLocation">showLocation</a></li><li><a href="global.html#styleNav">styleNav</a></li><li><a href="global.html#stylesArticle">stylesArticle</a></li><li><a href="global.html#stylesContent">stylesContent</a></li><li><a href="global.html#stylesList">stylesList</a></li><li><a href="global.html#TermsOfUse">TermsOfUse</a></li><li><a href="global.html#TextArea">TextArea</a></li><li><a href="global.html#TIMEOUT_CONTRACT">TIMEOUT_CONTRACT</a></li><li><a href="global.html#unenroll">unenroll</a></li><li><a href="global.html#unregister">unregister</a></li><li><a href="global.html#unregisterPanel">unregisterPanel</a></li><li><a href="global.html#updateItemList">updateItemList</a></li><li><a href="global.html#updateState">updateState</a></li><li><a href="global.html#validate">validate</a></li><li><a href="global.html#validateError">validateError</a></li><li><a href="global.html">validation</a></li><li><a href="global.html#wipe">wipe</a></li><li><a href="global.html#withAdminDashboardLayout">withAdminDashboardLayout</a></li><li><a href="global.html#withAsyncComponent">withAsyncComponent</a></li><li><a href="global.html#withAuthenticationLayout">withAuthenticationLayout</a></li><li><a href="global.html#withGLPI">withGLPI</a></li><li><a href="global.html#withHandleMessages">withHandleMessages</a></li><li><a href="global.html#years">years</a></li></ul></li></ul>
  </div>
    <div class="col-md-18 navigation-section">
    <div id="main">

        <h1 class="page-title">Source: containers/Fleets/components/FleetsContent.js</h1>

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 *   Copyright © 2018 Teclib. All rights reserved.
 *
 *   This file is part of web-mdm-dashboard
 *
 * web-mdm-dashboard is a subproject of Flyve MDM. Flyve MDM is a mobile
 * device management software.
 *
 * Flyve MDM is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 3
 * of the License, or (at your option) any later version.
 *
 * Flyve MDM is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * ------------------------------------------------------------------------------
 * @author     Gianfranco Manganiello (gmanganiello@teclib.com)
 * @author     Hector Rondon (hrondon@teclib.com)
 * @copyright  Copyright © 2018 Teclib. All rights reserved.
 * @license    GPLv3 https://www.gnu.org/licenses/gpl-3.0.html
 * @link       https://github.com/flyve-mdm/web-mdm-dashboard
 * @link       http://flyve.org/web-mdm-dashboard
 * @link       https://flyve-mdm.com
 * ------------------------------------------------------------------------------
 */

/** import dependencies */
import React, {
  PureComponent,
} from 'react'
import PropTypes from 'prop-types'
import WinJS from 'winjs'
import I18n from 'shared/i18n'
import itemtype from 'shared/itemtype'
import publicURL from 'shared/publicURL'
import getID from 'shared/getID'
import ContentPane from 'components/ContentPane'
import Loading from 'components/Loading'
import Confirmation from 'components/Confirmation'
import FleetsTaskItemList from './FleetsTaskItemList'

/**
 * @class FleetsContent
 * @extends PureComponent
 */
class FleetsContent extends PureComponent {
  /** @constructor */
  constructor(props) {
    super(props)
    const { itemType } = this.props

    this.state = {
      layout: {
        type: WinJS.UI.ListLayout,
      },
      itemID: undefined,
      itemType,
      selectedItems: [],
      isLoading: false,
      notManaged: false,
      input: '',
      data: {
        policies: undefined,
        tasks: undefined,
        categories: undefined,
        files: undefined,
        applications: undefined,
        tasksNew: {},
        tasksRemove: {},
      },
      devicesLength: 0,
    }
  }

  /**
   * @function componentDidMount
   */
  componentDidMount = () => {
    const { notManaged } = this.state

    if (!notManaged) {
      this.requestAllData()
    } else {
      this.resetData()
    }
  }

  /**
   * @function componentDidUpdate
   * @param {object} prevProps
   * @param {object} prevState
   */
  componentDidUpdate(prevProps, prevState) {
    const {
      itemID,
      notManaged,
    } = this.state

    if (prevState.itemID !== itemID) {
      if (!notManaged) {
        this.requestAllData()
      } else {
        this.resetData()
      }
    }
  }

  /**
   * Make sure that the state and props are in sync for when it is required
   * @static
   * @function getDerivedStateFromProps
   * @param {object} nextProps
   * @param {object} prevState
   */
  static getDerivedStateFromProps(nextProps, prevState) {
    if (prevState.itemID !== getID(nextProps.history.location.pathname)) {
      return {
        ...prevState,
        isLoading: true,
        itemID: getID(nextProps.history.location.pathname),
        input: nextProps.selectedItems.length === 1 ? nextProps.selectedItems[0]['PluginFlyvemdmFleet.name'] : I18n.t('fleets.new_fleet'),
        notManaged: nextProps.selectedItems.length === 1 ? nextProps.selectedItems[0][
          'PluginFlyvemdmFleet.is_default'
        ] === 1 : false,
        selectedItems: nextProps.selectedItems,
      }
    }
    return null
  }

  /**
   * Get Task value
   * @function getValueOfTask
   * @param {object} policy
   * @param {*} fleetHaveTask
   */
  getValueOfTask = (policy, fleetHaveTask) => {
    const { data } = this.state

    // Check if the current Fleet have a Task that have a relation with this Policy
    if (fleetHaveTask) {
      // Return a Object that is the Task
      switch (policy['PluginFlyvemdmPolicy.type']) {
        case 'deployapp':
        case 'removeapp':
        case 'deployfile':
        case 'removefile':
          return data.tasksNew[policy['PluginFlyvemdmPolicy.id']] ? data.tasksNew[policy[
            'PluginFlyvemdmPolicy.id']] : policy['PluginFlyvemdmPolicy.recommended_value']
        default:
          return data.tasksNew[policy['PluginFlyvemdmPolicy.id']] ? data.tasksNew[policy[
            'PluginFlyvemdmPolicy.id']].value : policy['PluginFlyvemdmPolicy.recommended_value']
      }
    } else {
      // Return recommended value
      return policy['PluginFlyvemdmPolicy.recommended_value']
    }
  }

  /**
   * Get policy type
   * @function getTypeData
   * @param {object} policy
   */
  getTypeData = (policy) => {
    const { data } = this.state

    const policyType = policy['PluginFlyvemdmPolicy.type']
    // Check if the policy default value are applications, files or other
    switch (policyType) {
      case 'deployapp':
      case 'removeapp':
        return data.applications
      case 'deployfile':
      case 'removefile':
        return data.files
      case 'dropdown':
        return Object.entries(JSON.parse(policy['PluginFlyvemdmPolicy.type_data']))
      default:
        return JSON.parse(policy['PluginFlyvemdmPolicy.type_data'])
    }
  }

  /**
   * handle request all data to show fleet policies
   * @function requestAllData
   * @async
   */
  requestAllData = async () => {
    const {
      glpi,
      changeSelectionMode,
      changeAction,
    } = this.props
    const {
      input,
      itemID,
      itemType,
    } = this.state

    /*
     * Get Devices
     * */
    const devices = await glpi.searchItems({
      itemtype: itemtype.PluginFlyvemdmAgent,
      criteria: [{
        link: 'and',
        field: 3,
        searchtype: 'contains',
        value: input,
      }],
    })

    /*
     * Get Policies
     * */
    const countPolicies = await glpi.searchItems({
      itemtype: itemtype.PluginFlyvemdmPolicy,
      options: {
        uid_cols: true,
        range: '0-0',
      },
    })
    const policies = await glpi.searchItems({
      itemtype: itemtype.PluginFlyvemdmPolicy,
      options: {
        uid_cols: true,
        forcedisplay: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
        range: `0-${countPolicies.totalcount}`,
      },
    })

    let tasks = []
    const tasksNew = {}

    if (Number(itemID)) {
      /*
       * Get Tasks
       * */
      try {
        const countTasks = await glpi.searchItems({
          itemtype: itemtype.PluginFlyvemdmTask,
          options: {
            uid_cols: true,
            range: '0-0',
          },
          criteria: [
            {
              link: 'and',
              field: 9,
              searchtype: 'equals',
              value: itemType,
            },
            {
              link: 'and',
              field: 10,
              searchtype: 'equals',
              value: itemID,
            },
          ],
        })

        tasks = await glpi.searchItems({
          itemtype: itemtype.PluginFlyvemdmTask,
          options: {
            uid_cols: true,
            forcedisplay: [1, 2, 3, 5, 6, 7],
            range: `0-${countTasks.totalcount}`,
          },
          criteria: [{
            link: 'and',
            field: 9,
            searchtype: 'equals',
            value: itemType,
          },
          {
            link: 'and',
            field: 10,
            searchtype: 'equals',
            value: itemID,
          },
          ],
        })
      } catch (error) {
        this.props.toast.setNotification(this.props.handleMessage({
          type: 'alert',
          message: error,
        }))
        changeSelectionMode(false)
        changeAction('reload')
      }

      if (tasks.data) {
        tasks.data.forEach((task) => {
          const taskDeploy = {
            itemtype_applied: itemType,
            items_id_applied: task['PluginFlyvemdmTask.items_id_applied'],
            plugin_flyvemdm_policies_id: task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id'],
            value: task['PluginFlyvemdmTask.value'],
          }

          if (task['PluginFlyvemdmTask.itemtype']) {
            taskDeploy.itemtype = task['PluginFlyvemdmTask.itemtype']
          }
          if (task['PluginFlyvemdmTask.items_id']) {
            taskDeploy.items_id = task['PluginFlyvemdmTask.items_id']
          }

          const deployType = policies.data.filter(policy => (
            policy['PluginFlyvemdmPolicy.type'] === 'deployapp'
                || policy['PluginFlyvemdmPolicy.type'] === 'removeapp'
                || policy['PluginFlyvemdmPolicy.type'] === 'deployfile'
                || policy['PluginFlyvemdmPolicy.type'] === 'removefile')
              &amp;&amp; (policy['PluginFlyvemdmPolicy.id'] === taskDeploy.plugin_flyvemdm_policies_id))

          if (deployType.length > 0) {
            if (tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']]) {
              tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].push(taskDeploy)
            } else {
              tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']] = [taskDeploy]
            }
          } else {
            tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']] = taskDeploy
          }
        })
      }
    }

    /*
     * Get categories
     * */
    const countCategories = await glpi.searchItems({
      itemtype: itemtype.PluginFlyvemdmPolicyCategory,
      options: {
        uid_cols: true,
        range: '0-0',
      },
    })
    const categories = await glpi.searchItems({
      itemtype: itemtype.PluginFlyvemdmPolicyCategory,
      options: {
        uid_cols: true,
        forcedisplay: [1, 2],
        range: `0-${countCategories.totalcount}`,
      },
    })

    /*
     * Get files
     */
    const files = await glpi.getAllItems({
      itemtype: itemtype.PluginFlyvemdmFile,
    })

    /*
     * Get Applications
     */

    const applications = await glpi.getAllItems({
      itemtype: itemtype.PluginFlyvemdmPackage,
    })

    /*
     * Update props
     */
    this.setState(() => ({
      isLoading: false,
      data: {
        tasks: tasks.data ? tasks.data : [],
        tasksNew,
        policies: policies.data ? policies.data : [],
        categories: categories.data ? categories.data : [],
        files: files || [],
        applications: applications || [],
        tasksRemove: {},
      },
      devicesLength: devices.totalcount,
    }))
  }

  /**
   * Set value when input change
   * @function handleChangeInput
   * @param {object} e
   */
  handleChangeInput = (e) => {
    this.setState({
      input: e.target.value,
    })
  }

  /**
   * Get if task is enable/disable
   * @function handleFleetHaveTask
   * @param {object} policy
   * @returns {boolean}
   */
  handleFleetHaveTask = (policy) => {
    const { data } = this.state

    return (!!data.tasksNew[policy['PluginFlyvemdmPolicy.id']])
  }

  /**
   * Reset state
   * @function resetData
   */
  resetData = () => {
    this.setState({
      isLoading: false,
      data: {
        policies: undefined,
        tasks: undefined,
        categories: undefined,
        files: undefined,
        applications: undefined,
        tasksNew: {},
        tasksRemove: {},
      },
      devicesLength: 0,
    })
  }

  /**
   * filter Policies by categorie
   * @function filterPoliciesPerCategory
   * @return {array}
   */
  filterPoliciesPerCategory = () => {
    const { data } = this.state

    const policiesPerCategory = []

    data.categories.forEach((category) => {
      const obj = {}
      const categoryCompleteName = category['PluginFlyvemdmPolicyCategory.completename']
      const policiesPerThisCategory = data.policies.filter(policy => policy['PluginFlyvemdmPolicy.PluginFlyvemdmPolicyCategory.completename']
          === categoryCompleteName)
      obj.name = categoryCompleteName
      obj.id = category['PluginFlyvemdmPolicyCategory.id']
      obj.policies = policiesPerThisCategory
      policiesPerCategory.push(obj)
    })
    return policiesPerCategory
  }

  /**
   * handle add task from fleet
   * @function handleAddTask
   * @param {object} policy
   */
  handleAddTask = (policy) => {
    const {
      data,
      itemType,
      itemID,
    } = this.state

    if (policy) {
      if (policy['PluginFlyvemdmPolicy.type'] !== 'deployapp'
        &amp;&amp; policy['PluginFlyvemdmPolicy.type'] !== 'removeapp'
        &amp;&amp; policy['PluginFlyvemdmPolicy.type'] !== 'deployfile'
        &amp;&amp; policy['PluginFlyvemdmPolicy.type'] !== 'removefile') {
        const tasks = { ...data.tasksRemove }
        delete tasks[policy['PluginFlyvemdmPolicy.id']]

        const addPolicy = {
          itemtype_applied: itemType,
          items_id_applied: Number(itemID) ? itemID : null,
          plugin_flyvemdm_policies_id: policy['PluginFlyvemdmPolicy.id'],
          value: policy['PluginFlyvemdmPolicy.recommended_value'],
        }

        this.setState(prevState => ({
          data: {
            ...prevState.data,
            tasksNew: {
              ...prevState.data.tasksNew,
              [policy['PluginFlyvemdmPolicy.id']]: addPolicy,
            },
            tasksRemove: tasks,
          },
        }))
      }
    }
  }

  /**
   * handle remove task from fleet
   * @function handleRemoveTask
   * @param {object} policy
   */
  handleRemoveTask = (policy) => {
    const {
      data,
      itemType,
      itemID,
    } = this.state

    if (policy) {
      const tasks = { ...data.tasksNew }
      delete tasks[policy['PluginFlyvemdmPolicy.id']]
      let removePolicy

      switch (policy['PluginFlyvemdmPolicy.type']) {
        case 'deployapp':
        case 'removeapp':
        case 'deployfile':
        case 'removefile':
          if (data.tasksNew[policy['PluginFlyvemdmPolicy.id']]) {
            removePolicy = data.tasksNew[policy['PluginFlyvemdmPolicy.id']].map(item => item)
          }
          break
        default:
          removePolicy = {
            itemtype_applied: itemType,
            items_id_applied: Number(itemID) ? itemID : null,
            plugin_flyvemdm_policies_id: policy['PluginFlyvemdmPolicy.id'],
            value: policy['PluginFlyvemdmPolicy.default_value'],
          }
          break
      }
      if (removePolicy) {
        this.setState(prevState => ({
          data: {
            ...prevState.data,
            tasksNew: tasks,
            tasksRemove: {
              ...prevState.data.tasksRemove,
              [policy['PluginFlyvemdmPolicy.id']]: removePolicy,
            },
          },
        }))
      }
    }
  }

  /**
   * handle update task value
   * @function handleUpdateValueTask
   * @param {object} policy
   * @param {*} value
   */
  handleUpdateValueTask = (policy, value) => {
    const {
      itemType,
      itemID,
      data,
    } = this.state


    if (policy) {
      let newDeploy
      let newValue
      let alreadyTask = []
      let tasksToRemove = {}
      switch (policy['PluginFlyvemdmPolicy.type']) {
        case 'bool':
          newValue = value ? 1 : 0
          break
        case 'deployapp':
          newDeploy = {
            itemtype_applied: itemType,
            items_id_applied: Number(itemID) ? itemID : null,
            plugin_flyvemdm_policies_id: policy['PluginFlyvemdmPolicy.id'],
            value: {
              remove_on_delete: 1,
            },
            items_id: Number(value),
            itemtype: itemtype.PluginFlyvemdmPackage,
          }
          if (data.tasksNew[policy['PluginFlyvemdmPolicy.id']]) {
            alreadyTask = data.tasksNew[policy['PluginFlyvemdmPolicy.id']].filter(item => item.items_id === newDeploy.items_id)
          }
          tasksToRemove = { ...data.tasksRemove }
          if (tasksToRemove[policy['PluginFlyvemdmPolicy.id']]) {
            data.tasksRemove[policy['PluginFlyvemdmPolicy.id']].forEach((item, index) => {
              if (item.items_id === newDeploy.items_id) {
                tasksToRemove[policy['PluginFlyvemdmPolicy.id']].splice(index, 1)
              }
            })
          }
          break
        case 'removeapp':
        case 'removefile':
          newDeploy = {
            itemtype_applied: itemType,
            items_id_applied: Number(itemID) ? itemID : null,
            plugin_flyvemdm_policies_id: policy['PluginFlyvemdmPolicy.id'],
            value,
          }
          if (data.tasksNew[policy['PluginFlyvemdmPolicy.id']]) {
            alreadyTask = data.tasksNew[policy['PluginFlyvemdmPolicy.id']].filter(item => item.value === newDeploy.value)
          }
          tasksToRemove = { ...data.tasksRemove }
          if (tasksToRemove[policy['PluginFlyvemdmPolicy.id']]) {
            data.tasksRemove[policy['PluginFlyvemdmPolicy.id']].forEach((item, index) => {
              if (item.value === newDeploy.value) {
                tasksToRemove[policy['PluginFlyvemdmPolicy.id']].splice(index, 1)
              }
            })
          }
          break
        case 'deployfile':
          newDeploy = {
            itemtype_applied: itemType,
            items_id_applied: Number(itemID) ? itemID : null,
            plugin_flyvemdm_policies_id: policy['PluginFlyvemdmPolicy.id'],
            value: {
              destination: '%DOCUMENTS%',
              remove_on_delete: 1,
            },
            items_id: Number(value),
            itemtype: itemtype.PluginFlyvemdmFile,
          }
          if (data.tasksNew[policy['PluginFlyvemdmPolicy.id']]) {
            alreadyTask = data.tasksNew[policy['PluginFlyvemdmPolicy.id']].filter(item => item.items_id === newDeploy.items_id)
          }
          tasksToRemove = { ...data.tasksRemove }
          if (tasksToRemove[policy['PluginFlyvemdmPolicy.id']]) {
            data.tasksRemove[policy['PluginFlyvemdmPolicy.id']].forEach((item, index) => {
              if (item.items_id === newDeploy.items_id) {
                tasksToRemove[policy['PluginFlyvemdmPolicy.id']].splice(index, 1)
              }
            })
          }
          break
        default:
          newValue = value
          break
      }

      if (alreadyTask.length === 0) {
        this.setState((prevState) => {
          if (policy['PluginFlyvemdmPolicy.type'] === 'deployapp'
            || policy['PluginFlyvemdmPolicy.type'] === 'removeapp'
            || policy['PluginFlyvemdmPolicy.type'] === 'deployfile'
            || policy['PluginFlyvemdmPolicy.type'] === 'removefile') {
            let newDeployAdd = []
            if (prevState.data.tasksNew[policy['PluginFlyvemdmPolicy.id']]) {
              newDeployAdd = [
                ...prevState.data.tasksNew[policy['PluginFlyvemdmPolicy.id']],
                newDeploy,
              ]
            } else {
              newDeployAdd = [
                newDeploy,
              ]
            }

            return {
              data: {
                ...prevState.data,
                tasksNew: {
                  ...prevState.data.tasksNew,
                  [policy['PluginFlyvemdmPolicy.id']]: newDeployAdd,
                },
                tasksRemove: tasksToRemove,
              },
            }
          }
          return {
            data: {
              ...prevState.data,
              tasksNew: {
                ...prevState.data.tasksNew,
                [policy['PluginFlyvemdmPolicy.id']]: {
                  ...prevState.data.tasksNew[policy['PluginFlyvemdmPolicy.id']],
                  value: newValue,
                },
              },
            },
          }
        })
      }
    }
  }

  /**
   * Handle remove task value
   * @function handleRemoveValueTask
   * @param {object} policy
   * @param {object} task
   */
  handleRemoveValueTask = (policy, task) => {
    const {
      data,
      itemType,
      itemID,
    } = this.state

    let newTasks

    if (data.tasksNew[task.plugin_flyvemdm_policies_id]) {
      switch (policy['PluginFlyvemdmPolicy.type']) {
        case 'deployapp':
        case 'deployfile':
          newTasks = data.tasksNew[task.plugin_flyvemdm_policies_id].filter(item => item.items_id !== task.items_id)
          break
        case 'removeapp':
        case 'removefile':
          newTasks = data.tasksNew[task.plugin_flyvemdm_policies_id].filter(item => item.value !== task.value)
          break
        default:
          break
      }

      const removePolicy = {
        itemtype_applied: itemType,
        items_id_applied: Number(itemID) ? itemID : null,
        plugin_flyvemdm_policies_id: task.plugin_flyvemdm_policies_id,
        value: task.value,
      }

      if (task.itemtype) {
        removePolicy.itemtype = task.itemtype
      }
      if (task.items_id) {
        removePolicy.items_id = task.items_id
      }

      let newRemoveTasks = []
      if (data.tasksRemove[task.plugin_flyvemdm_policies_id]) {
        newRemoveTasks = [...data.tasksRemove[task.plugin_flyvemdm_policies_id], removePolicy]
      } else {
        newRemoveTasks = [removePolicy]
      }

      this.setState(prevState => ({
        data: {
          ...prevState.data,
          tasksNew: {
            ...prevState.data.tasksNew,
            [task.plugin_flyvemdm_policies_id]: newTasks,
          },
          tasksRemove: {
            ...prevState.data.tasksRemove,
            [task.plugin_flyvemdm_policies_id]: newRemoveTasks,
          },
        },
      }))
    }
  }

  /**
   * Handle save Fleet
   * @function handleSaveFleet
   * @async
   */
  handleSaveFleet = async () => {
    const {
      itemType,
      notManaged,
    } = this.state
    const { selectedItems } = this.props

    if (itemType === itemtype.PluginFlyvemdmFleet) {
      if (selectedItems.length === 1) {
        if (!notManaged) {
          this.handleUpdateFleet()
        } else {
          this.handleUpdateFleetName()
        }
      } else {
        this.handleCreateFleet()
      }
    } else {
      this.handleUpdateFleet()
    }
  }

  /**
   * Handle update fleet name
   * @function handleUpdateFleetName
   * @async
   */
  handleUpdateFleetName = async () => {
    const {
      input,
      itemID,
    } = this.state
    const {
      glpi,
      changeAction,
    } = this.props

    try {
      this.setState({
        isLoading: true,
      })
      const fleetToUpdate = {
        name: input,
      }

      await glpi.updateItem({
        itemtype: itemtype.PluginFlyvemdmFleet,
        id: itemID,
        input: fleetToUpdate,
      })

      this.props.toast.setNotification({
        title: I18n.t('commons.success'),
        body: I18n.t('notifications.fleet_successfully_updated'),
        type: 'success',
      })

      changeAction('reload')

      this.setState({
        isLoading: false,
      })
    } catch (error) {
      this.props.toast.setNotification(this.props.handleMessage({
        type: 'alert',
        message: error,
      }))
      this.setState({
        isLoading: false,
      })
    }
  }

  /**
   * handle update fleet
   * @function handleUpdateFleet
   * @async
   */
  // eslint-disable-next-line
  handleUpdateFleet = async () => {
    const {
      input,
      data,
      itemType,
      itemID,
    } = this.state
    const {
      glpi,
    } = this.props

    this.setState({
      isLoading: true,
    })
    const fleetToUpdate = {
      name: input,
    }
    let itemsToDelete = []

    if (data.tasksRemove) {
      itemsToDelete = data.tasks.filter((task) => {
        // Check if the same Policy id is equal on object to remove
        if (Array.isArray(data.tasksRemove[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']])) {
          const value = data.tasksRemove[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].filter(
            (item) => {
              if (item.items_id) {
                return item.items_id === task['PluginFlyvemdmTask.items_id']
              }
              return item.value === task['PluginFlyvemdmTask.value']
            },
          )

          return value.length > 0
        }
        return !!data.tasksRemove[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']]
      }).map(item => ({
        id: item['PluginFlyvemdmTask.id'],
      }))
    }
    const itemsToUpdate = []

    const specialPolicies = data.policies.filter(policy => policy['PluginFlyvemdmPolicy.type'] === 'deployapp' || policy['PluginFlyvemdmPolicy.type']
        === 'removeapp' || policy['PluginFlyvemdmPolicy.type'] === 'deployfile' || policy['PluginFlyvemdmPolicy.type']
        === 'removefile')

    data.tasks.forEach((task) => {
      if (data.tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']]) {
        let idDeployApp

        for (const element of specialPolicies) {
          if (element['PluginFlyvemdmPolicy.id'] === task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']) {
            idDeployApp = element['PluginFlyvemdmPolicy.id']
            break
          }
        }

        if (!idDeployApp) {
          if (data.tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].value !== task[
            'PluginFlyvemdmTask.value']) {
            itemsToUpdate.push({
              id: task['PluginFlyvemdmTask.id'],
              value: data.tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].value,
            })
          }
        }
      }
    })

    const itemsToAdd = { ...data.tasksNew }
    // eslint-disable-next-line
    data.tasks.forEach((task) => {
      if (Array.isArray(itemsToAdd[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']])) {
        data.tasksNew[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].forEach((item, index) => {
          if (task['PluginFlyvemdmTask.items_id']) {
            return item.items_id === task['PluginFlyvemdmTask.items_id'] ? itemsToAdd[task[
              'PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].splice(index, 1) : null
          }
          return item.value === task['PluginFlyvemdmTask.value'] ? itemsToAdd[task[
            'PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']].splice(index, 1) : null
        })
      } else {
        return itemsToAdd[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']] ? delete itemsToAdd[task[
          'PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']] : null
      }
    })

    const itemsToSave = []
    Object.values(itemsToAdd).forEach((item) => {
      if (Array.isArray(item)) {
        item.forEach((deploy) => {
          itemsToSave.push(deploy)
        })
      } else {
        itemsToSave.push(item)
      }
    })
    try {
      if (itemType === itemtype.PluginFlyvemdmFleet) {
        await glpi.updateItem({
          itemtype: itemtype.PluginFlyvemdmFleet,
          id: itemID,
          input: fleetToUpdate,
        })
      }
      if (itemsToDelete.length > 0) {
        await glpi.deleteItem({
          itemtype: itemtype.PluginFlyvemdmTask,
          input: itemsToDelete,
        })
      }

      if (itemsToUpdate.length > 0) {
        await glpi.updateItem({
          itemtype: itemtype.PluginFlyvemdmTask,
          input: itemsToUpdate,
        })
      }

      if (itemsToSave.length > 0) {
        await glpi.addItem({
          itemtype: itemtype.PluginFlyvemdmTask,
          input: itemsToSave,
        })
      }

      this.props.toast.setNotification({
        title: I18n.t('commons.success'),
        body: I18n.t('notifications.fleet_successfully_updated'),
        type: 'success',
      })
      this.requestAllData()
    } catch (error) {
      this.props.toast.setNotification(this.props.handleMessage({
        type: 'alert',
        message: error,
      }))
      this.requestAllData()
    }
  }

  /**
   * handle create new fleet
   * @function handleCreateFleet
   * @async
   */
  handleCreateFleet = async () => {
    const {
      input,
      data,
    } = this.state
    const {
      glpi,
      changeSelectionMode,
      changeAction,
    } = this.props

    this.setState({
      isLoading: true,
    })

    try {
      const fleetToCreate = {
        name: input,
      }

      const newFleet = await glpi.addItem({
        itemtype: itemtype.PluginFlyvemdmFleet,
        input: fleetToCreate,
      })

      const itemsToAdd = { ...data.tasksNew }

      data.tasks.map(task => (itemsToAdd[task['PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']] ? delete itemsToAdd[task[
        'PluginFlyvemdmTask.PluginFlyvemdmPolicy.id']] : null))

      const itemsToSave = []
      Object.values(itemsToAdd).forEach((item) => {
        /* eslint no-param-reassign: ["error", { "props": false }] */
        if (Array.isArray(item)) {
          item.forEach((deploy) => {
            deploy.items_id_applied = newFleet.id

            try {
              const objValue = JSON.parse(deploy.value)
              deploy.value = objValue
            } catch (e) {}

            itemsToSave.push(deploy)
          })
        } else {
          item.items_id_applied = newFleet.id
          itemsToSave.push(item)
        }
      })

      if (itemsToSave.length > 0) {
        await glpi.addItem({
          itemtype: itemtype.PluginFlyvemdmTask,
          input: itemsToSave,
        })
      }

      this.setState({
        isLoading: false,
      })
      this.props.toast.setNotification({
        title: I18n.t('commons.success'),
        body: I18n.t('notifications.fleet_successfully_created'),
        type: 'success',
      })
      changeSelectionMode(false)
      changeAction('reload')
    } catch (error) {
      this.props.toast.setNotification(this.props.handleMessage({
        type: 'alert',
        message: error,
      }))
      this.setState({
        isLoading: false,
      })
    }
  }

  /**
   * Handle remove fleet
   * @function handleDeleteFleet
   * @async
   * @param {object} eventObject
   */
  handleDeleteFleet = async () => {
    const {
      selectedItems,
      glpi,
      changeSelectionMode,
      changeAction,
    } = this.props
    const { itemID } = this.state

    if (selectedItems.length === 1) {
      this.setState({
        isLoading: true,
      })

      try {
        await glpi.deleteItem({
          itemtype: itemtype.PluginFlyvemdmFleet,
          id: itemID,
        })

        this.setState({
          isLoading: false,
        })
        this.props.toast.setNotification({
          title: I18n.t('commons.success'),
          body: I18n.t('notifications.fleet_successfully_removed'),
          type: 'success',
        })
        changeSelectionMode(false)
        changeAction('reload')
      } catch (error) {
        this.props.toast.setNotification(this.props.handleMessage({
          type: 'alert',
          message: error,
        }))
        this.setState({
          isLoading: false,
        })
      }
    }
  }

  /**
   * handle duplicate selected fleet
   * @function handleDuplicateFleet
   */
  handleDuplicateFleet = () => {
    this.setState(prevState => ({
      input: prevState.input !== '' ? prevState.input.concat(' copy') : 'Copy',
      data: {
        tasks: [],
        tasksNew: prevState.data.tasksNew,
        policies: prevState.data.policies,
        categories: prevState.data.categories,
        files: prevState.data.files,
        applications: prevState.data.applications,
        tasksRemove: {},
      },
    }), () => {
      this.handleCreateFleet()
    })
  }

  /**
   * Go to devices list
   * @function goToList
   */
  goToList = () => {
    const { history } = this.props
    const { itemID } = this.state

    history.push(`${publicURL}/app/fleets/${itemID}/list`)
  }

  /**
   * Render component
   * @function render
   */
  render() {
    const {
      data,
      isLoading,
      itemType,
      input,
      devicesLength,
      notManaged,
    } = this.state
    const { selectedItems } = this.props

    let policiesPerCategory

    if (data.policies
      &amp;&amp; data.categories
      &amp;&amp; data.tasksNew
      &amp;&amp; data.files
      &amp;&amp; data.applications) {
      policiesPerCategory = this.filterPoliciesPerCategory()
    }
    if (isLoading) {
      return (
        &lt;Loading message={`${I18n.t('commons.loading')}...`} />
      )
    }
    return (
      &lt;ContentPane>
        &lt;div className="fleets" style={ { display: 'flex', flexDirection: 'column', height: '100%' } }>
          &lt;div style={ { display: '-moz-flex', flexDirection: 'row' } }>
            &lt;div className="content-header">
              {
                  itemType === itemtype.PluginFlyvemdmFleet
                    ? (
                      &lt;React.Fragment>
                        &lt;h1 className="content-header__title">
                          &lt;input
                            type="text"
                            className="win-textbox"
                            placeholder={I18n.t('fleets.input_name')}
                            name="fleetName"
                            onChange={this.handleChangeInput}
                            value={input}
                          />
                        &lt;/h1>
                        &lt;div
                          className="devices__length"
                          onClick={this.goToList}
                          role="button"
                          tabIndex="0"
                        >
                          &lt;div>
                            {devicesLength}
                          &lt;/div>
                          &lt;span className="iconFont deviceIcon" />
                        &lt;/div>
                      &lt;/React.Fragment>
                    )
                    : ''
                }
              &lt;div className="item-info">
                &lt;span
                  className="iconFont saveIcon"
                  onClick={this.handleSaveFleet}
                  role="button"
                  tabIndex="0"
                />
                {
                  selectedItems.length !== 0 &amp;&amp; itemType === itemtype.PluginFlyvemdmFleet
                    ? (
                      &lt;React.Fragment>
                        &lt;span
                          className="iconFont copyIcon"
                          onClick={this.handleDuplicateFleet}
                          role="button"
                          tabIndex="0"
                        />
                        &lt;span
                          className="iconFont deleteIcon"
                          onClick={this.handleDeleteFleet}
                          role="button"
                          tabIndex="0"
                        />
                      &lt;/React.Fragment>
                    )
                    : ''
                }
              &lt;/div>
              &lt;div className="item-info" style={ { display: 'table-cell', verticalAlign: 'middle' } }>
                &lt;div />
              &lt;/div>
            &lt;/div>
          &lt;/div>
          &lt;div style={ { display: '-moz-flex', flexDirection: 'row' } }>
            &lt;div className="separator" style={ { width: '100%' } } />
          &lt;/div>
          &lt;div style={ { display: 'flex', flexDirection: 'row', overflowY: 'auto' } }>
            &lt;div className="content-info">
              &lt;h3 style={ { margin: '10px' } }>
                {I18n.t('fleets.tasks_per_Category')}
              &lt;/h3>
              &lt;div>
                {
                  policiesPerCategory ? (
                    policiesPerCategory.map(category => (category.policies.length > 0
                      ? (
                        &lt;div key={category.id}>
                          &lt;div className="title">
                            {category.name}
                          &lt;/div>
                          &lt;div>
                            {category.policies.map((policy, index) => (
                              &lt;FleetsTaskItemList
                                key={[policy['PluginFlyvemdmPolicy.name'], index].join('_')}
                                fleetHaveTask={this.handleFleetHaveTask(policy)}
                                data={policy}
                                value={this.getValueOfTask(policy, this.handleFleetHaveTask(policy))}
                                addTask={this.handleAddTask}
                                removeTask={this.handleRemoveTask}
                                updateValueTask={this.handleUpdateValueTask}
                                removeValueTask={this.handleRemoveValueTask}
                                typeData={this.getTypeData(policy)}
                              />
                            ))}
                          &lt;/div>
                        &lt;/div>
                      )
                      : null))
                  )
                    : notManaged
                      ? (
                        &lt;h1>
                          {I18n.t('fleets.not_managed')}
                        &lt;/h1>
                      )
                      : (
                        &lt;h1>
                          {I18n.t('fleets.loading_tasks')}
                        &lt;/h1>
                      )}
              &lt;/div>
            &lt;/div>
          &lt;/div>
          &lt;Confirmation
            title="Delete Fleets"
            message={`${selectedItems.length} Fleets`}
            reference={(el) => { this.contentDialog = el } }
          />
        &lt;/div>
      &lt;/ContentPane>
    )
  }
}

FleetsContent.defaultProps = {
  selectedItems: null,
  itemType: null,
}

FleetsContent.propTypes = {
  toast: PropTypes.shape({
    setNotification: PropTypes.func,
  }).isRequired,
  handleMessage: PropTypes.func.isRequired,
  history: PropTypes.object.isRequired,
  selectedItems: PropTypes.array,
  itemType: PropTypes.string,
}

export default FleetsContent
</code></pre>
        </article>
    </section>




    </div>
  </div>

<br class="clear">
